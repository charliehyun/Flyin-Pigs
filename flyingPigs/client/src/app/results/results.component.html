<login-signup style="position: absolute; right: 0px;"></login-signup>
<img src="assets/images/BOTTOM_CROPPED_LOGO.png" alt="Flyin' Pigs" routerLink="/search" width="8%" [style]="{cursor:'pointer'}">
<h2>Flights</h2>
<!-- SEARCH -->
<p-panel styleClass="p-shadow-3" header="Search Parameters" toggler="header" [toggleable]="true" expandIcon="pi pi-plus-circle" collapseIcon="pi pi-minus-circle" [collapsed]="true">
  <search-box [style]="{'margin': '0px'}"></search-box>
</p-panel>

<p-toast position="top-left"></p-toast>
<!-- FILTER -->
<p-card [style]="{'height': '150px'}" styleClass="p-shadow-3">
  <h5>Filters</h5>
  <div [style]="{float: 'left'}"> 
      <!-- Layover -->
      <button pButton pRipple type="button" (click)="op4.toggle($event)" class="p-button-outlined" label="Stops"></button>
      <p-overlayPanel #op4 [showCloseIcon]="true"> 
        <div *ngFor="let stop of stops" class="p-field-checkbox">
          <p-radioButton [inputId]="stop.key" name="stop" [value]="stop" [(ngModel)]="selectedStop"></p-radioButton>
          <label [for]="stop.key">{{stop.name}}</label>
        </div>
      </p-overlayPanel>

      <!-- Price -->
      <button pButton pRipple type="button" (click)="op1.toggle($event)" class="p-button-outlined" label="Price"></button>
      <p-overlayPanel #op1 [showCloseIcon]="true" [style]="{width: '300px'}"> 
        <div>
          <div class="overlay1">
            $<input type="number" size="5" pInputText [(ngModel)]="totalPrice[0]" (ngModelChange)="totalPrice = [totalPrice[0], totalPrice[1]]"/>
          </div>
          <div class="overlay2">
            $<input type="number" size="5" pInputText [(ngModel)]="totalPrice[1]" (ngModelChange)="totalPrice = [totalPrice[0], totalPrice[1]]"/>
          </div>
          <br><br>
          <div>
            <p-slider [(ngModel)]="totalPrice" [range]="true" [min]="minPrice" [max]="maxPrice" [step]="1" [style]="{width: '250px'}"></p-slider>
          </div>
        </div>
      </p-overlayPanel>

      <!-- Duration -->
      <button pButton pRipple type="button" (click)="op2.toggle($event)" class="p-button-outlined" label="Duration"></button>
      <p-overlayPanel #op2 [showCloseIcon]="true" [style]="{width: '380px'}"> 
        <div>
          <label class="overlay3">Max Total Travel Time (hr):</label>
          <div class="overlay2">
            <input type="number" size="5" pInputText [(ngModel)]="maxDepartTravelTime"/>
          </div>
          <br><br><br>
          <label class="overlay3">Max Flight Duration (hr):</label>
          <div class="overlay2">
            <input type="number" size="5" pInputText [(ngModel)]="maxDepartFlightTime"/>
          </div>
        </div>
      </p-overlayPanel>
      
      <!-- Times -->
      <button pButton pRipple type="button" (click)="op3.toggle($event)" class="p-button-outlined" label="Times"></button>
      <p-overlayPanel #op3 [showCloseIcon]="true"> 
        <div>
          <label class="overlay3">Depart between:</label>
          <div class="overlay2">
            <input type="time" size="5" min="00:00" max="24:00" value="12:00" pInputText [(ngModel)]="departTimeStart"/>
            -
            <input type="time" size="5" min="00:00" max="24:00" value="12:00" pInputText [(ngModel)]="departTimeEnd"/>
          </div>
        </div>
        <div>
          <br><br><br>
          <label class="overlay3">Arrive between:</label>
          <div class="overlay2">
            <input type="time" size="5" min="00:00" max="24:00" value="0:00"pInputText [(ngModel)]="arrivalTimeStart"/>
            -
            <input type="time" size="5" min="00:00" max="24:00" value="0:00"pInputText [(ngModel)]="arrivalTimeEnd"/>
          </div>
        </div>
      </p-overlayPanel>

      <!-- Airports -->
      <button pButton pRipple type="button" (click)="op5.toggle($event)" class="p-button-outlined" label="Airports"></button>
      <p-overlayPanel #op5 [showCloseIcon]="true" [style]="{width: '350px'}"> 
        <div>
          <label>Departure Airports: </label> <br>
          <p-multiSelect [options]="filterDepartAirports" [(ngModel)]="selectedDepartAirports" display="chip" [style]="{width: '100%'}"></p-multiSelect>
        </div>
        <div>
          <label>Arrival Airports: </label> <br>
          <p-multiSelect [options]="filterArrivalAirports" [(ngModel)]="selectedArrivalAirports" display="chip" [style]="{width: '100%'}"></p-multiSelect>
        </div>
      </p-overlayPanel>

      <!-- Airlines -->
      <button pButton pRipple type="button" (click)="op6.toggle($event)" class="p-button-outlined" label="Airlines"></button>
      <p-overlayPanel #op6 [showCloseIcon]="true" [style]="{width: '350px'}"> 
        <div>
          <label>Departure Airlines: </label> <br>
          <p-multiSelect [options]="filterAirlines" [(ngModel)]="selectedAirlines" display="chip" [style]="{width: '100%'}"></p-multiSelect>
        </div>
      </p-overlayPanel>    
  </div>
  <div [style]="{float: 'right'}">
    <button pButton pRipple type="button" class="p-button-outlined p-button-secondary" label="Clear Filters" (click)="resetFilter()"></button> 
    <button pButton pRipple type="button" label="Filter" (click)="filterResults()"></button> 
  </div>
</p-card>

<!-- RESULTS -->
<div>
  <h4>Results</h4>
</div>

<!-- Table -->
<p-table [value]="displayTrips" dataKey="uniqueCode" styleClass="p-shadow-3">
  <!-- Column names -->
  <ng-template pTemplate="header">
    <tr>
      <th>Airline</th>
      <th pSortableColumn="timeToAirportA">{{selectedDTransport.code}} Time To Airport <p-sortIcon field="timeToAirportA"></p-sortIcon></th>
      <!-- <th>Departure Airport</th> -->
      <th pSortableColumn="departingFlight.departureTime">Departure Time <p-sortIcon field="departingFlight.departureTime"></p-sortIcon></th>
      <th pSortableColumn="departingFlight.flightTime">Flight Duration <p-sortIcon field="departingFlight.flightTime"></p-sortIcon></th>
      <!-- <th>Arrival Airport</th> -->
      <th pSortableColumn="departingFlight.arrivalTime">Arrival Time <p-sortIcon field="departingFlight.arrivalTime"></p-sortIcon></th>
      <th pSortableColumn="timeToAirportB">{{selectedATransport.code}} Time From Airport <p-sortIcon field="timeToAirportB"></p-sortIcon></th>
      <th pSortableColumn="totalDepTime">Total Travel Time <p-sortIcon field="totalDepTime"></p-sortIcon></th>
      <th pSortableColumn="departingFlight.numberOfStops">Number of Stops <p-sortIcon field="departingFlight.numberOfStops"></p-sortIcon></th>
      <th pSortableColumn="flightPrice">Price <p-sortIcon field="flightPrice"></p-sortIcon></th>
      <th>More Details</th>
    </tr>
  </ng-template>
  <!-- Row content -->
  <ng-template pTemplate="body" let-trip let-expanded="expanded">
    <tr>
      <!-- Airline -->
      <td style="text-align:center">
        <span *ngIf="trip.departingFlight.airlines.length > 1">
          <img src="assets/images/generic-logo.png" width="50" height="40">
        </span>
        <span *ngIf="trip.departingFlight.airlines.length < 2">
          <!-- <img *ngIf="trip.departingFlight.airlines == 'AA'" src="assets/images/aa-logo.png" width="40" height="40"> -->
          <img *ngIf="trip.departingFlight.airlines == 'AS'" src="assets/images/alaska-logo.png" width="40" height="40">
          <img *ngIf="trip.departingFlight.airlines == 'B6'" src="assets/images/jetblue-logo.png" width="40">
          <img *ngIf="trip.departingFlight.airlines == 'DL'" src="assets/images/delta-logo.png" width="40" height="40">
          <img *ngIf="trip.departingFlight.airlines == 'F9'" src="assets/images/frontier-logo.png" width="40" height="40"> 
          <img *ngIf="trip.departingFlight.airlines == 'HA'" src="assets/images/hawaiian-logo.png" width="40" height="40"> 
          <img *ngIf="trip.departingFlight.airlines == 'NK'" src="assets/images/spirit-logo.png" width="40" height="40"> 
          <img *ngIf="trip.departingFlight.airlines == 'UA'" src="assets/images/united-logo.png" width="45" height="45"> 
          <!-- <img *ngIf="trip.departingFlight.airlines == 'WN'" src="assets/images/southwest-logo.png" width="40">  -->
          <img *ngIf="!airlineTags.includes(trip.departingFlight.airlines[0])" src="assets/images/generic-logo.png" width="50" height="40">
        </span>
        <p style="color:grey;">{{trip.departingFlight.airlines}}</p>
      </td>
      <!-- <td>{{trip.timeToAirportA}}</td> -->
      <td>{{(trip.timeToAirportA / 3600).toFixed(0)}} hr {{((trip.timeToAirportA % 3600) / 60).toFixed(0)}} min</td> 
      <!-- <td>{{trip.departingFlight.departureAirport}}</td> -->
      <td>
        <p>{{trip.departingFlight.departureTime}}</p>
        <p style="color:grey;">{{trip.departingFlight.departureAirport}}</p>
      </td>
      <!-- <td>{{trip.departingFlight.flightTime}}</td> -->
      <td>{{(trip.departingFlight.flightTime / 3600).toFixed(0)}} hr {{((trip.departingFlight.flightTime % 3600) / 60).toFixed(0)}} min</td>
      <!-- <td>{{trip.departingFlight.arrivalAirport}}</td> -->
      <td>
        <p>{{trip.departingFlight.arrivalTime}}</p>
        <p style="color:grey;">{{trip.departingFlight.arrivalAirport}}</p>
      </td>
      <!-- <td>{{trip.timeToAirportB}}</td> -->
      <!-- THIS ONE HAS THE CORRECT IMPLEMENTATION BUT ITS UGLY -->
      <td>{{(trip.timeToAirportB / 3600) - (trip.timeToAirportB / 3600)%1}} hr {{((trip.timeToAirportB % 3600) / 60).toFixed(0)}} min</td> 
      <!-- <td>{{trip.totalDepTime}}</td> -->
      <td>{{(trip.totalDepTime / 3600).toFixed(0)}} hr {{((trip.totalDepTime % 3600) / 60).toFixed(0)}} min</td>
      <td>{{trip.departingFlight.numberOfStops}}</td>
      <td>${{trip.flightPrice}}</td>
      <td>
        <button type="button" pButton pRipple [pRowToggler]="trip" class="p-button-text p-button-rounded p-button-plain" [icon]="expanded ? 'pi pi-chevron-up' : 'pi pi-chevron-down'"></button>
      </td>
    </tr>
  </ng-template>
  <!-- More details -->
  <ng-template pTemplate="rowexpansion" let-trip>
    <tr>
      <td colspan="12">
        <div class="p-3">
          <!-- <p-card header="Stop Overs"> -->
            <tr *ngFor="let stops of trip.departingFlight.segments">
              <td>Number of Seats:{{trip.availSeats}}</td>
              <td>Airline:{{stops.airline}}, </td>
              <td>Departure Airport:{{stops.depAirportCode}}, </td>
              <td>Arrival Airport:{{stops.arrAirportCode}}, </td>
              <td>Stop Over Duration:{{stops.segmentDuration}}, </td>
              <td>Departure Time:{{stops.departTime}}, </td>
              <td>Arrival Time:{{stops.arrivalTime}}</td>
            </tr>
            <div class="p-grid p-nogutter">
              <div class="p-col">
                <p-timeline [value]="events1" styleClass="customized-timeline" style="align-items: left;">
                  <!-- <ng-template pTemplate="marker" let-event>
                    <span class="custom-marker p-shadow-2" [style.backgroundColor]="event.color">
                              <i [ngClass]="event.icon"></i>
                          </span>
                  </ng-template> -->
                  <ng-template pTemplate="content" let-event>
                    <small class="p-text-secondary">&#123;&#123;event.date&#125;&#125;</small><br>
                    <b>{{event.status}}</b>
                    <!-- <p-card [header]="event.status" [subheader]="event.date"> -->
                      <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Inventore sed consequuntur error
                        repudiandae numquam deserunt
                        quisquam repellat libero asperiores earum nam nobis, culpa ratione quam perferendis esse, cupiditate
                        neque quas!</p>
                    <!-- </p-card> -->
                  </ng-template>
                  <ng-template pTemplate="opposite" let-event>
                    <br><br><br>
                    <i [ngClass]="event.icon"></i>
                    <!-- <br><br> -->
                  </ng-template>
                </p-timeline>
              </div>
              <div class="p-col">
                hello
              </div>
            </div>

            <!-- <p-timeline [value]="trip.departingFlight.segments" align="alternate" styleClass="customized-timeline">
              <ng-template pTemplate="marker" let-stops>
                <span class="custom-marker p-shadow-2">
                  <i class="pi pi-car"></i>
                </span>
              </ng-template>
              <ng-template pTemplate="content" let-stops>
                <p-card [header]="stops.depAirportCode" [subheader]="stops.segmentDuration">
                    hello
                </p-card>
              </ng-template>
              <ng-template pTemplate="opposite" let-stops>
                <small class="p-text-secondary">{{stops.departTime}}</small>
              </ng-template>
            </p-timeline> -->
          <!-- </p-card> -->
        </div>
      </td>
    </tr>
  </ng-template>
</p-table>
<div class="loadMore" *ngIf="shouldLoad">
  <button pButton pRipple type="button"  label="Load 10 More" (click)="loadMore()" ></button>
</div>

<!-- Loading -->
<i class="pi pi-spin pi-spinner" *ngIf="!filteredTrips" style="font-size: 2rem; display: flex; align-items: center; justify-content: center;" ></i>

<!-- No flights -->
<div *ngIf="filteredTrips?.length == 0">
  <p-card [style]="{'background':'#f4cccc'}">
      No flights match your search:(
  </p-card>
</div>

<footer>
  <p-button label="Search" styleClass="p-button-link" icon="pi pi-search" routerLink="/search"></p-button>
  <p-button label="FAQ" styleClass="p-button-link" icon="pi pi-question-circle" routerLink="/faq"></p-button>
  <p-button label="Give Feedback" styleClass="p-button-link" icon="pi pi-comment" routerLink="/feedback"></p-button>
  <p-button label="Github" styleClass="p-button-link" icon="pi pi-github" onclick="window.open('https://github.com/jyeh00/Flyin-Pigs','_blank')"></p-button>
  <p> 2022 Flyin' Pigs </p>
</footer>

<p-scrollTop 
  icon="pi pi-arrow-up" 
  width="2px"
  height="2px"
  styleClass="custom-scrolltop"
></p-scrollTop>
