<img src="favicon.ico" alt="Flyin' Pigs" routerLink="/search" width="100px" [style]="{cursor:'pointer'}">
<h2>Flights</h2>
<!-- SEARCH -->
<p-panel header="Search Parameters" toggler="header" [toggleable]="true" expandIcon="pi pi-plus-circle" collapseIcon="pi pi-minus-circle" [collapsed]="true">
<!-- <p-accordion [multiple]="true">
  <p-accordionTab header="Search Parameters" [selected]="true" > -->
    <!-- COPY START -->
    <div>
      <div class="p-grid p-nogutter">
        <div class="p-col">
          <h4>Departure</h4>
          <!-- Address -->
          <span>
            <label for="daddress">
              Starting Address
              <i class="pi pi-question-circle" style="white-space: pre-line" 
                pTooltip="Where are you leaving from? Input an address or a general location." 
                tooltipPosition="top"
              ></i>
            </label>
            <input 
              pInputText 
              type="text" 
              id="daddress" 
              name="daddress" 
              size="35" 
              required 
              ngx-google-places-autocomplete 
              [options]="options" 
              (onAddressChange)="AddressChange1($event)" 
              [(ngModel)]="departAdd"
              tooltipPosition="right" 
              tooltipEvent="focus"
            >
          </span>
          <br>

          <!-- Transportation method -->
          <span>
            <label for="dTransportType">
              Mode of Transport
              <i class="pi pi-question-circle" style="white-space: pre-line" 
                pTooltip="How will you be getting to the departure airport?" 
                tooltipPosition="top"
              ></i>
            </label>
            <p-dropdown 
              id="dTransportType" 
              [options]="dTransportType" 
              [(ngModel)]="selectedDTransport" 
              placeholder="Select a Mode of Transport" 
              optionLabel="name"
              tooltipPosition="right" 
              tooltipEvent="focus"
            ></p-dropdown>
          </span>
          <br>

          <!-- Transport Hours Before Flight -->
          <span>
            <label for="drivingStartHours">
              Maximum approximate {{selectedDTransport.code}} time
              <i class="pi pi-question-circle" style="white-space: pre-line" 
                pTooltip="How long are you willing to travel to get to the departure airport?" 
                tooltipPosition="top"
              ></i>
            </label>
            <p-dropdown 
              id="drivingStartHours" 
              [options]="hours" 
              [(ngModel)]="maxTimeStart" 
              optionLabel="name"
              tooltipPosition="right" 
              tooltipEvent="focus"
            ></p-dropdown>
          </span>
        </div>
        <p-divider layout="vertical"></p-divider>
        <div class="p-col">
          <h4>Arrival</h4>
          <!-- Address -->
          <span>
            <label for="aaddress">
              Destination Address
              <i class="pi pi-question-circle" style="white-space: pre-line" 
                pTooltip="Where are you traveling to?" 
                tooltipPosition="top"
              ></i>
            </label>
            <input 
              pInputText 
              type="text" 
              id="aaddress" 
              name="aaddress" 
              size="35" 
              required 
              ngx-google-places-autocomplete 
              [options]="options" 
              (onAddressChange)="AddressChange2($event)" 
              [(ngModel)]="arriveAdd"
              tooltipPosition="right" 
              tooltipEvent="focus"
            >
          </span>
          <br>

          <!-- Transportation method -->
          <span>
            <label for="aTransportType">
              Mode of Transport
              <i class="pi pi-question-circle" style="white-space: pre-line" 
                pTooltip="How will you be getting to your destination from the airport?" 
                tooltipPosition="top"
              ></i>
            </label>
            <p-dropdown 
              id="aTransportType" 
              [options]="aTransportType" 
              [(ngModel)]="selectedATransport" 
              placeholder="Select a Mode of Transport" 
              optionLabel="name"
              tooltipPosition="right"
              tooltipEvent="focus"
            ></p-dropdown>
          </span>
          <br>

          <!-- Transport Hours After Flight -->
          <span>
            <label for="drivingEndHours">
              Maximum approximate {{selectedATransport.code}} time
              <i class="pi pi-question-circle" style="white-space: pre-line" 
                pTooltip="How long are you willing to travel to get to your destination from the airport?" 
                tooltipPosition="top"
              ></i>
            </label>
            <p-dropdown 
              [options]="hours" 
              [(ngModel)]="maxTimeEnd" 
              optionLabel="name" 
              tooltipPosition="right" 
              tooltipEvent="focus"
            ></p-dropdown>
          </span>
        </div>
      </div>

      <div>
        <br><hr><br>
        <!-- One way/Round trip -->
        One Way 
        <p-inputSwitch [(ngModel)]="isRoundTrip" (onChange)="handleOneWay($event)" [style]="{'vertical-align':'middle'}"></p-inputSwitch>
        Round Trip &nbsp;

        <!-- Passenger # and selection Overlay -->
        <button pButton pRipple type="button" (click)="op.toggle($event)" icon="pi pi-user" label="{{totalPass}}"></button>
        <p-overlayPanel #op [showCloseIcon]="true" (onHide)="updatePassengers()"> 
          <div>
            <label for="adult" class="pass1">Adults</label>
            <div class="pass2">
              <p-inputNumber 
                [(ngModel)]="adultPass" 
                inputId="adult" 
                [showButtons]="true" 
                buttonLayout="horizontal" 
                incrementButtonIcon="pi pi-plus" 
                decrementButtonIcon="pi pi-minus" 
                [min]=0 
                [size]=1
              ></p-inputNumber>
            </div>
            <br><br><br>
            <label for="child" class="pass1">Children</label>
            <div class="pass2">
              <p-inputNumber 
                [(ngModel)]="childPass" 
                inputId="child" 
                [showButtons]="true" 
                buttonLayout="horizontal" 
                incrementButtonIcon="pi pi-plus" 
                decrementButtonIcon="pi pi-minus" 
                [min]=0 
                [size]=1
              ></p-inputNumber>
            </div>
            <br><br><br>
            <label for="infant" class="pass1">Infants</label>
            <div class="pass2">
              <p-inputNumber 
                [(ngModel)]="infantPass" 
                inputId="infant" 
                [showButtons]="true" 
                buttonLayout="horizontal" 
                incrementButtonIcon="pi pi-plus" 
                decrementButtonIcon="pi pi-minus" 
                [min]=0 
                [size]=1
              ></p-inputNumber>
            </div>
            <br><br><br>
            <button pButton pRipple type="button" (click)="updatePassengers(); op.hide()">
              <i class="pi pi-check"></i>
            </button>
          </div>
        </p-overlayPanel>
              
        <!-- Class -->
        <p-dropdown [options]="classes" [(ngModel)]="selectedClass" placeholder="Select a Class" optionLabel="name"></p-dropdown>
        
        <!-- Dates -->
        <label for="departDate">Departure Date: </label>
        <input pInputText type="date" [(ngModel)]="departDate" id="departDate" name="departDate" min="{{this.date}}" required>
        <label for="returnDate" *ngIf="isRoundTrip">Return Date: </label>
        <input pInputText type="date" [(ngModel)]="returnDate" id="returnDate" name="returnDate" min="{{this.departDate}}" *ngIf="isRoundTrip">
      </div>
      
    </div>
    <div align="center">
      <!-- Clear/Search -->
      <button pButton pRipple type="button" (click)="handleClear()" label="Clear Search" class="p-button-outlined p-button-secondary"></button>
      <button pButton pRipple type="button" (click)="handleSearch()" label="Search"></button>
    </div>
    <!-- COPY END -->
  <!-- </p-accordionTab>
</p-accordion> -->
</p-panel>

<p-toolbar class="toolbar" >
  <div class="p-toolbar-group-left"> 
      <!--
        <i class="p-toolbar-separator pi pi-bars mr-2" style="vertical-align: middle"></i>
        <p-dropdown [options]="numStops" [(ngModel)]="selectedStops" placeholder="Dropdown" optionLabel="stops"></p-dropdown>
        <span class="p-input-icon-left">
        <i class="pi pi-search"></i>
        <input type="text" pInputText [(ngModel)]="stops" placeholder="Stops">         
      </span>
      -->

      <!-- Layover overlay-->
      <button pButton pRipple type="button" (click)="op4.toggle($event)"  label="Stops"></button>
      <p-overlayPanel #op4 [showCloseIcon]="true" (onHide)="updateStops()"> 
        <div *ngFor="let stop of stops" class="p-field-checkbox">
          <p-radioButton [inputId]="stop.key" name="stop" [value]="stop" [(ngModel)]="selectedStop"></p-radioButton>
          <label [for]="stop.key">{{stop.name}}</label>
        </div>
      </p-overlayPanel>

      <!--Price overlay-->
      <button pButton pRipple type="button" (click)="op1.toggle($event)"  label="Price"></button>
      <p-overlayPanel #op1 [showCloseIcon]="true" [style]="{width: '300px'}" (onHide)="updateTotalPrice()"> 
        <div>
          <div class="pass4">
            $<input type="text" size="5" pInputText [(ngModel)]="totalPrice[0]"/>
          </div>
          <div class="pass5">
            $<input type="text" size="5" pInputText [(ngModel)]="totalPrice[1]"/>
          </div>
          
          <br><br>
          <div>
            <p-slider [min]="0" [(ngModel)]="totalPrice" [range]="true" [max]="10000" [min]="1" [style]="{width: '250px'}"></p-slider>
          </div>
          
          
          
          
        </div>
      </p-overlayPanel>

      <!-- Duration overlay-->
      <button pButton pRipple type="button" (click)="op2.toggle($event)"  label="Duration"></button>
      <p-overlayPanel #op2 [showCloseIcon]="true" [style]="{width: '400px'}" (onHide)="updateDuration()"> 
        <div>
          <label>Max Total Travel Time (hr):</label>
          <div class="pass2">
            <input type="text" size="5" pInputText [(ngModel)]="maxTravelTime"/>
          </div>
          <br><br><br>
          <label>Max Flight Duration (hr):</label>
          <div class="pass2">
            <input type="text" size="5" pInputText [(ngModel)]="maxFlightTime"/>
          </div>
        </div>
      </p-overlayPanel>
      
      <!--Times overlay-->
      <button pButton pRipple type="button" (click)="op3.toggle($event)"  label="Times"></button>
      <p-overlayPanel #op3 [showCloseIcon]="true" (onHide)="updateTravelTimes()"> 
        <div>
          <label class="pass3">Depart by: </label>
          <div class="pass2">
            <input type="text" size="5" pInputText [(ngModel)]="departTime"/>
          </div>
        </div>
        <div>
          <p-slider [(ngModel)]="departTime"></p-slider>
        </div>
        
        <div>
          <label class="pass3">Arrive by: </label>
          <div class="pass2">
            <input type="text" size="5" pInputText [(ngModel)]="arrivalTime"/>
          </div>
        </div><br><br>
        <div>
          <p-slider [(ngModel)]="arrivalTime"></p-slider>
        </div>
      </p-overlayPanel>

      <!--Airport overlay-->
      <button pButton pRipple type="button" (click)="op5.toggle($event)"  label="Airports"></button>
      <p-overlayPanel #op5 [showCloseIcon]="true" (onHide)="updateTotalPrice()"> 
        <div>
          <label>Departure Airports: </label> <br>
          All Airports: (add toggle) <br>
          <p-treeSelect [(ngModel)]="filterDepartAirports" [options]="numStops" display="chip" [metaKeySelection]="false"
          selectionMode="checkbox" >
          </p-treeSelect>
        </div>
        <div>
          <label>Arrival Airports: </label> <br>
          All Airports: (add toggle) <br>
          <p-treeSelect [(ngModel)]="filterArrivalAirports" [options]="numStops" display="chip" [metaKeySelection]="false"
          selectionMode="checkbox">
          </p-treeSelect>
        </div>
      </p-overlayPanel>

      <!--Airline overlay-->
      <button pButton pRipple type="button" (click)="op6.toggle($event)"  label="Airlines"></button>
      <p-overlayPanel #op6 [showCloseIcon]="true" (onHide)="updateTotalPrice()"> 
        <div>
          <label>Departure Airlines: </label> <br>
          All Airlines: (add toggle) <br>
          <p-treeSelect [(ngModel)]="filterDepartAirlines" [options]="numStops" display="chip" [metaKeySelection]="false"
          selectionMode="checkbox" placeholder="Airlines">
          </p-treeSelect>
        </div>
        
      </p-overlayPanel>

      <p-treeSelect [(ngModel)]="filterDepartAirlines" [options]="numStops" display="chip" [metaKeySelection]="false"
        selectionMode="checkbox" placeholder="Airlines">
      </p-treeSelect>

      
      
  </div>
  
</p-toolbar>

<!-- RESULTS -->
<div>
    <h4>Results</h4>
</div>

<!-- No flights -->
<div *ngIf="filteredTrips?.length == 0">
    <p-card [style]="{'background':'#f4cccc'}">
        No flights match your search:(
    </p-card>
</div>

<!-- Table -->
<p-table [value] = "displayTrips" dataKey="name" responsiveLayout="scroll">
    <!-- Column names -->
    <ng-template pTemplate="header">
        <tr>
            <th>Airline</th>
            <th pSortableColumn="timeToAirportA">{{selectedDTransport.code}} Time To Airport <p-sortIcon field="timeToAirportA"></p-sortIcon></th>
            <th>Departure Airport</th>
            <th pSortableColumn="departingFlight.departureTime">Departure Time <p-sortIcon field="departingFlight.departureTime"></p-sortIcon></th>
            <th pSortableColumn="departingFlight.flightTime">Flight Duration <p-sortIcon field="departingFlight.flightTime"></p-sortIcon></th>
            <th>Arrival Airport</th>
            <th pSortableColumn="departingFlight.arrivalTime">Arrival Time <p-sortIcon field="departingFlight.arrivalTime"></p-sortIcon></th>
            <th pSortableColumn="timeToAirportB">{{selectedATransport.code}} Time From Airport <p-sortIcon field="timeToAirportB"></p-sortIcon></th>
            <th pSortableColumn="totalDepTime">Total Travel Time <p-sortIcon field="totalDepTime"></p-sortIcon></th>
            <th pSortableColumn="departingFlight.numberOfStops">Number of Stops <p-sortIcon field="departingFlight.numberOfStops"></p-sortIcon></th>
            <th pSortableColumn="flightPrice">Price <p-sortIcon field="flightPrice"></p-sortIcon></th>
            <th style="width: 3rem"></th>
        </tr>
    </ng-template>
    <!-- Row content -->
    <ng-template pTemplate="body" let-trip let-expanded="expanded">
        <tr>
            <td>{{trip.departingFlight.airlines}}</td>
            <td>{{trip.timeToAirportA}}</td> 
            <td>{{trip.departingFlight.departureAirport}}</td>
            <td>{{trip.departingFlight.departureTime}}</td>
            <td>{{trip.departingFlight.flightTime}}</td>
            <td>{{trip.departingFlight.arrivalAirport}}</td>
            <td>{{trip.departingFlight.arrivalTime}}</td>
            <td>{{trip.timeToAirportB}}</td> 
            <td>{{trip.totalDepTime}}</td>
            <td>{{trip.departingFlight.numberOfStops}}</td>
            <td>${{trip.flightPrice}}</td>
            <td>
                <button type="button" pButton pRipple [pRowToggler]="trip" class="p-button-text p-button-rounded p-button-plain" [icon]="expanded ? 'pi pi-chevron-up' : 'pi pi-chevron-down'"></button>
            </td>
        </tr>
    </ng-template>
    <!-- More details -->
    <ng-template pTemplate="rowexpansion" let-trip>
        <tr>
            <td colspan="12">
                <div class="p-3">
                    <p-card header="Stop Overs">
                        <tr *ngFor="let stops of trip.departingFlight.stopOvers">
                          <td>Airline:{{stops.airline}}, </td>
                          <td>Departure Airport:{{stops.depAirportCode}}, </td>
                          <td>Arrival Airport:{{stops.arrAirportCode}}, </td>
                          <td>Stop Over Duration:{{stops.stopOverDuration}}, </td>
                          <td>Departure Time:{{stops.departTime}}, </td>
                          <td>Arrival Time:{{stops.arrivalTime}}</td>
                        </tr>
                    </p-card>
                </div>
            </td>
        </tr>
    </ng-template>
</p-table>
<div class="loadMore" *ngIf="shouldLoad">
  <button pButton pRipple type="button"  label="Load 10 More" (click)="loadMore()" ></button>
</div>

<!-- Loading -->
<i class="pi pi-spin pi-spinner" *ngIf="!filteredTrips" style="font-size: 2rem; display: flex; align-items: center; justify-content: center;" ></i>



<p-scrollTop 
  icon="pi pi-arrow-up" 
  width="2px"
  height="2px"
  styleClass="custom-scrolltop"
  ></p-scrollTop>
